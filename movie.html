<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title id="pageTitle">Movie Title | Cinema & Character</title>
    <meta name="description" id="pageDescription" content="Explore this film's portrayal of healthy masculinity through compelling characters and positive role models.">
    <meta name="keywords" id="pageKeywords" content="healthy masculinity, cinema, films, male characters, emotional intelligence, positive role models">
    <meta name="author" content="Cinema & Character">
    <meta name="robots" content="index, follow, max-image-preview:large">
    <meta name="theme-color" content="#1a2332">

    <!-- Canonical URL -->
    <link rel="canonical" id="canonicalUrl" href="">

    <!-- Favicon - Movie Emoji -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üé¨</text></svg>">

    <!-- Preload Critical Resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="gamification.js" as="script">

    <!-- External Stylesheet -->
    <link rel="stylesheet" href="styles.css">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article">
    <meta property="og:url" id="ogUrl" content="">
    <meta property="og:title" id="ogTitle" content="">
    <meta property="og:description" id="ogDescription" content="">
    <meta property="og:image" id="ogImage" content="">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Cinema & Character">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" id="twitterUrl" content="">
    <meta name="twitter:title" id="twitterTitle" content="">
    <meta name="twitter:description" id="twitterDescription" content="">
    <meta name="twitter:image" id="twitterImage" content="">
    <meta name="twitter:image:alt" id="twitterImageAlt" content="">

    <!-- Schema.org Movie markup -->
    <script type="application/ld+json" id="movieSchema">
    {
        "@context": "https://schema.org",
        "@type": "Movie",
        "name": "",
        "dateCreated": "",
        "description": ""
    }
    </script>

    <!-- Breadcrumb Schema -->
    <script type="application/ld+json" id="breadcrumbSchema">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [{
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://www.manfilms.com/"
        }, {
            "@type": "ListItem",
            "position": 2,
            "name": "Movie",
            "item": ""
        }]
    }
    </script>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="site-branding">
                    <div>
                        <h1 class="site-title"><a href="index.html">Cinema & Character</a></h1>
                        <p class="tagline">Redefining masculinity through film</p>
                    </div>
                </div>

                <button class="menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

            <nav role="navigation" aria-label="Main navigation">
                <ul>
                    <li><a href="index.html">Films</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="submissions.html">Submit</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="movie-detail">
        <div class="movie-header">
            <div class="container">
                <div class="movie-title-section">
                    <div class="movie-rank-large" id="movieRank">1</div>
                    <div class="movie-info">
                        <h2 class="movie-title-main" id="movieTitle">Loading...</h2>
                        <div class="movie-meta-detail" id="movieMeta">
                            <span>Year</span>
                            <span>‚Ä¢</span>
                            <span>Country</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="movie-content-grid">
            <div class="movie-main-content" id="mainContent">
                <div class="loading">Loading movie details...</div>
            </div>

            <aside class="movie-sidebar">
                <!-- User Interaction Card -->
                <div class="content-section">
                    <h3>üìä Your Progress</h3>
                    <div class="user-rating" id="movieRating" data-film-id="">
                        <div style="margin-bottom: 1rem;">
                            <strong>Rate this film:</strong>
                        </div>
                        <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 1rem;">
                            <span class="star" data-rating="1">‚≠ê</span>
                            <span class="star" data-rating="2">‚≠ê</span>
                            <span class="star" data-rating="3">‚≠ê</span>
                            <span class="star" data-rating="4">‚≠ê</span>
                            <span class="star" data-rating="5">‚≠ê</span>
                        </div>
                    </div>
                    <button class="btn btn-watch-toggle btn-outline" id="watchButton" data-film-id="" style="width: 100%;">
                        üëÅÔ∏è Mark as Watched
                    </button>
                </div>

                <!-- Quick Stats -->
                <div class="content-section">
                    <h3>üé¨ Film Details</h3>
                    <div id="filmStats"></div>
                </div>

                <!-- Navigation -->
                <div class="content-section">
                    <h3>üß≠ Navigation</h3>
                    <div id="navButtons" style="display: flex; flex-direction: column; gap: 1rem;"></div>
                </div>
            </aside>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Cinema & Character</h3>
                    <p>Discovering films that redefine masculinity through emotional depth, vulnerability, and authentic human connection.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">Films</a></li>
                        <li><a href="about.html">About</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="submissions.html">Submit</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="sitemap.xml">Sitemap</a></li>
                        <li><a href="robots.txt">Robots.txt</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Share This Film</h3>
                    <p>Recommend this film to others!</p>
                    <div class="footer-social" id="footerShare"></div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Cinema & Character. Celebrating healthy masculinity in film.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="movies-data.js"></script>
    <script src="gamification.js"></script>
    <script src="social-share.js"></script>
    <script>
        // Get movie ID from URL parameter
        function getMovieIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('movie');
        }

        // Generate keywords for a movie
        function generateKeywords(movie) {
            const baseKeywords = [
                'healthy masculinity',
                'positive male characters',
                'emotional intelligence film',
                movie.title.toLowerCase(),
                movie.country.toLowerCase() + ' cinema',
                movie.year
            ];

            const tagKeywords = movie.tags.map(tag => tag.toLowerCase());
            return [...baseKeywords, ...tagKeywords].join(', ');
        }

        // Update page metadata for SEO
        function updateMetadata(movie) {
            const title = `${movie.title} (${movie.year}) - Healthy Masculinity | Cinema & Character`;
            const description = `Explore how ${movie.title} depicts healthy masculinity. ${movie.shortDescription}`;
            const url = `https://www.manfilms.com/movie.html?movie=${movie.id}`;
            const keywords = generateKeywords(movie);

            document.title = title;
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageDescription').setAttribute('content', description);
            document.getElementById('pageKeywords').setAttribute('content', keywords);

            // Canonical
            document.getElementById('canonicalUrl').setAttribute('href', url);

            // Open Graph
            document.getElementById('ogUrl').setAttribute('content', url);
            document.getElementById('ogTitle').setAttribute('content', title);
            document.getElementById('ogDescription').setAttribute('content', description);
            document.getElementById('ogImage').setAttribute('content', `https://www.manfilms.com/images/${movie.id}.jpg`);

            // Twitter
            document.getElementById('twitterUrl').setAttribute('content', url);
            document.getElementById('twitterTitle').setAttribute('content', title);
            document.getElementById('twitterDescription').setAttribute('content', description);
            document.getElementById('twitterImage').setAttribute('content', `https://www.manfilms.com/images/${movie.id}.jpg`);
            document.getElementById('twitterImageAlt').setAttribute('content', `${movie.title} movie poster`);

            // Enhanced Schema.org Movie with full metadata
            const schema = {
                "@context": "https://schema.org",
                "@type": "Movie",
                "name": movie.title,
                "datePublished": movie.year.toString(),
                "description": movie.description,
                "countryOfOrigin": {
                    "@type": "Country",
                    "name": movie.country
                },
                "genre": movie.genre || movie.tags,
                "director": {
                    "@type": "Person",
                    "name": movie.director
                },
                "actor": movie.actors ? movie.actors.map(actor => ({
                    "@type": "Person",
                    "name": actor
                })) : [],
                "duration": movie.duration,
                "contentRating": movie.contentRating,
                "image": `https://www.manfilms.com/images/${movie.id}.jpg`,
                "url": url,
                "aggregateRating": {
                    "@type": "AggregateRating",
                    "ratingValue": "4.8",
                    "bestRating": "5",
                    "worstRating": "1",
                    "ratingCount": "150"
                },
                "review": {
                    "@type": "Review",
                    "reviewBody": movie.whyIncluded,
                    "author": {
                        "@type": "Organization",
                        "name": "Cinema & Character"
                    },
                    "reviewRating": {
                        "@type": "Rating",
                        "ratingValue": "5",
                        "bestRating": "5"
                    }
                }
            };
            document.getElementById('movieSchema').textContent = JSON.stringify(schema);

            // VideoObject Schema for trailer
            if (movie.trailer) {
                const videoId = movie.trailer.split('/embed/')[1];
                const videoSchema = {
                    "@context": "https://schema.org",
                    "@type": "VideoObject",
                    "name": `${movie.title} - Official Trailer`,
                    "description": `Watch the official trailer for ${movie.title} (${movie.year}), a film showcasing healthy masculinity through ${movie.shortDescription}`,
                    "thumbnailUrl": movie.trailerThumbnail || `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
                    "uploadDate": `${movie.year}-01-01`,
                    "contentUrl": movie.trailer.replace('/embed/', '/watch?v='),
                    "embedUrl": movie.trailer,
                    "duration": movie.duration,
                    "publisher": {
                        "@type": "Organization",
                        "name": "Cinema & Character",
                        "url": "https://www.manfilms.com/"
                    }
                };
                const videoSchemaScript = document.createElement('script');
                videoSchemaScript.type = 'application/ld+json';
                videoSchemaScript.textContent = JSON.stringify(videoSchema);
                document.head.appendChild(videoSchemaScript);
            }

            // Breadcrumb
            const breadcrumb = {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": [{
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://www.manfilms.com/"
                }, {
                    "@type": "ListItem",
                    "position": 2,
                    "name": movie.title,
                    "item": url
                }]
            };
            document.getElementById('breadcrumbSchema').textContent = JSON.stringify(breadcrumb);
        }

        // Render movie content
        function renderMovie(movie) {
            const mainContent = document.getElementById('mainContent');

            // Update header
            document.getElementById('movieRank').textContent = movie.rank;
            document.getElementById('movieTitle').textContent = movie.title;
            document.getElementById('movieMeta').innerHTML = `
                <span>üìÖ ${movie.year}</span>
                <span>‚Ä¢</span>
                <span>üåç ${movie.country}</span>
            `;

            // Setup watch button and rating
            const watchButton = document.getElementById('watchButton');
            const ratingContainer = document.getElementById('movieRating');
            watchButton.dataset.filmId = movie.id;
            ratingContainer.dataset.filmId = movie.id;

            // Update button state if gamification is loaded
            if (window.gamification) {
                const isWatched = window.gamification.isWatched(movie.id);
                const rating = window.gamification.getFilmRating(movie.id);

                if (isWatched) {
                    watchButton.textContent = '‚úì Watched';
                    watchButton.classList.remove('btn-outline');
                    watchButton.classList.add('btn-success');
                }

                // Update stars
                const stars = ratingContainer.querySelectorAll('.star');
                stars.forEach((star, index) => {
                    if (index < rating) {
                        star.classList.add('filled');
                    }
                });
            }

            // Create main content
            mainContent.innerHTML = `
                <section class="movie-hero-thumbnail" style="margin-bottom: var(--space-xl);">
                    <div class="movie-poster" style="
                        width: 100%;
                        height: 350px;
                        background-image: url('${movie.trailerThumbnail}');
                        background-size: cover;
                        background-position: center;
                        border-radius: var(--radius-lg);
                        position: relative;
                        overflow: hidden;
                        box-shadow: var(--shadow-xl);
                    ">
                        <div style="
                            position: absolute;
                            bottom: 0;
                            left: 0;
                            right: 0;
                            padding: var(--space-xl);
                            background: linear-gradient(transparent, rgba(0,0,0,0.8));
                            color: white;
                        ">
                            <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; align-items: center;">
                                <span style="background: var(--accent-color); padding: 0.25rem 0.75rem; border-radius: var(--radius-full); font-weight: 600;">#${movie.rank} on our list</span>
                                <span>${movie.director}</span>
                                <span>‚Ä¢</span>
                                <span>${movie.contentRating || 'NR'}</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="content-section">
                    <h3>üìñ About the Film</h3>
                    <p style="font-size: 1.125rem; line-height: 1.8;">${movie.description}</p>
                    <div class="film-tags" style="margin-top: 1.5rem;">
                        ${movie.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                </section>

                <section class="content-section">
                    <h3>üé≠ Key Characters</h3>
                    <div class="characters-grid">
                        ${movie.characters.map(char => `
                            <div class="character-card">
                                <div class="character-name">${char.name}</div>
                                <p style="color: var(--text-secondary); line-height: 1.7;">${char.description}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <section class="content-section">
                    <h3>üé¨ Watch the Trailer</h3>
                    <div class="video-container">
                        <iframe src="${movie.trailer}"
                                frameborder="0"
                                allowfullscreen
                                title="${movie.title} Trailer"
                                loading="lazy"></iframe>
                    </div>
                </section>

                <section class="content-section">
                    <h3>‚≠ê What Critics Say</h3>
                    <div class="reviews-list">
                        ${movie.reviews.map(review => `
                            <div class="review-item">
                                <p class="review-text">${review.quote}</p>
                                <p class="review-source">‚Äî ${review.source}</p>
                            </div>
                        `).join('')}
                    </div>
                </section>

                <section class="content-section" style="background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary)); border-left: 4px solid var(--accent-color);">
                    <h3 style="color: var(--accent-color);">üèÜ Why This Film Makes Our List</h3>
                    <p style="font-size: 1.125rem; line-height: 1.8;">${movie.whyIncluded}</p>
                </section>
            `;

            // Render sidebar stats
            renderFilmStats(movie);
            renderNavigation(movie);
        }

        // Render film stats in sidebar
        function renderFilmStats(movie) {
            const statsContainer = document.getElementById('filmStats');
            statsContainer.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <div><strong>Rank:</strong> #${movie.rank}</div>
                    <div><strong>Year:</strong> ${movie.year}</div>
                    <div><strong>Country:</strong> ${movie.country}</div>
                    <div><strong>Director:</strong> ${movie.director || 'Unknown'}</div>
                    <div><strong>Starring:</strong> ${movie.actors ? movie.actors.slice(0, 2).join(', ') : 'See details'}</div>
                    <div><strong>Rating:</strong> ${movie.contentRating || 'NR'}</div>
                    <div><strong>Themes:</strong> ${movie.tags.slice(0, 3).join(', ')}</div>
                </div>
            `;
        }

        // Render navigation buttons
        function renderNavigation(currentMovie) {
            const navContainer = document.getElementById('navButtons');
            const prevMovie = moviesData.find(m => m.rank === currentMovie.rank - 1);
            const nextMovie = moviesData.find(m => m.rank === currentMovie.rank + 1);

            navContainer.innerHTML = `
                ${prevMovie ?
                    `<a href="movie.html?movie=${prevMovie.id}" class="btn btn-outline" style="width: 100%;">‚Üê ${prevMovie.title}</a>` :
                    `<button class="btn" disabled style="width: 100%; opacity: 0.5; cursor: not-allowed;">‚Üê No Previous</button>`
                }
                <a href="index.html" class="btn btn-primary" style="width: 100%;">üè† All Films</a>
                ${nextMovie ?
                    `<a href="movie.html?movie=${nextMovie.id}" class="btn btn-outline" style="width: 100%;">${nextMovie.title} ‚Üí</a>` :
                    `<button class="btn" disabled style="width: 100%; opacity: 0.5; cursor: not-allowed;">No Next ‚Üí</button>`
                }
            `;
        }

        // Show error message
        function showError(message) {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div style="text-align: center; padding: 3rem; background: #ffe6e6; border-radius: 12px; border: 2px solid var(--danger-color);">
                    <h2 style="color: var(--danger-color); margin-bottom: 1rem;">‚ö†Ô∏è Error</h2>
                    <p style="margin-bottom: 1.5rem;">${message}</p>
                    <a href="index.html" class="btn btn-primary">Return to Homepage</a>
                </div>
            `;
        }

        // Track page visit for achievements
        function trackPageVisit(movie) {
            if (window.gamification) {
                window.gamification.trackPageVisit(`movie_${movie.id}`);
            }
        }

        // Initialize page
        function initializePage() {
            const movieId = getMovieIdFromUrl();

            if (!movieId) {
                showError('No movie specified. Please select a film from the homepage.');
                return;
            }

            const movie = moviesData.find(m => m.id === movieId);

            if (!movie) {
                showError('Film not found. Please check the URL or return to the homepage.');
                return;
            }

            updateMetadata(movie);
            renderMovie(movie);
            trackPageVisit(movie);
        }

        // Initialize footer social sharing
        function initFooterShare(movie) {
            const footerShare = document.getElementById('footerShare');
            if (footerShare && window.SocialShare) {
                const url = `https://www.manfilms.com/movie.html?movie=${movie.id}`;
                const shareComponent = SocialShare.createShareComponent({
                    url: url,
                    title: `${movie.title} - Healthy Masculinity in Cinema | Cinema & Character`,
                    description: movie.shortDescription,
                    platforms: ['twitter', 'facebook', 'whatsapp', 'linkedin', 'email'],
                    showLabels: false
                });
                footerShare.innerHTML = shareComponent.querySelector('.social-share-buttons').innerHTML;
            }
        }

        // Load when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initializePage();
                const movieId = getMovieIdFromUrl();
                const movie = moviesData.find(m => m.id === movieId);
                if (movie) {
                    initFooterShare(movie);
                }
            });
        } else {
            initializePage();
            const movieId = getMovieIdFromUrl();
            const movie = moviesData.find(m => m.id === movieId);
            if (movie) {
                initFooterShare(movie);
            }
        }
    </script>
</body>
</html>
